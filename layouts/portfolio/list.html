{{/* layouts/portfolio/list.html */}}
{{ define "main" }}
{{- $pages := sort .RegularPages "Weight" "asc" "Date" "desc" "Title" "asc" }}
<ul class="portfolio-list">
        {{ range $pages }}
        {{/* Read build flags safely */}}
        {{ $render := "" }}
        {{ $list := "" }}
        {{ with .Params._build }}
        {{ $render = (index . "render" | default "") }}
        {{ $list = (index . "list" | default "") }}
        {{ end }}

        {{/* In development, show everything and make everything clickable */}}
        {{ $isDev := hugo.IsDevelopment }}

        {{/* Skip entirely if list == "never" (unless dev mode) or if draft (unless dev mode) */}}
        {{ $shouldShow := or $isDev (and (ne $list "never") (not .Draft)) }}
        {{ if $shouldShow }}
        {{/* In dev mode, always linkable. Otherwise only if render "" or "always" */}}
        {{ $linkable := or $isDev (or (eq $render "") (eq $render "always")) }}

        <li class="portfolio-item">
            <!-- Title -->
            {{ if $linkable }}
            <a href="{{ .RelPermalink }}" class="portfolio-title">{{ .Title }}</a>
            {{ else }}
            <span class="portfolio-title" aria-disabled="true" title="Write-up coming soon">{{ .Title }}</span>
            {{ end }}

            {{/* Summary */}}
            {{ if or .Params.summary .Summary }}
            <p class="portfolio-summary">
                {{ with .Params.summary }}{{ . }}{{ else }}{{ .Summary }}{{ end }}
            </p>
            {{ end }}

            {{/* Highlights */}}
            {{ with .Params.highlights }}
            {{ if gt (len .) 0 }}
            <ul class="portfolio-highlights">
                {{ range first 3 . }}<li>{{ . | markdownify }}</li>{{ end }}
            </ul>
            {{ end }}
            {{ end }}

            <!-- Tags -->
            {{ with .GetTerms "portfolio_tags" }}
            <div class="tags-block">
                {{ range . }}
                <a class="tag" href="{{ .RelPermalink }}">{{ .LinkTitle }}</a>
                {{ end }}
            </div>
            {{ end }}
        </li>
        {{ end }}
        {{ end }}
    </ul>
{{ end }}