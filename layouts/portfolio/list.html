{{/* layouts/portfolio/list.html */}}
{{ define "main" }}
<main>
    {{ .Content }}

    {{ $pages := sort .RegularPages "Weight" "asc" "Date" "desc" "Title" "asc" }}

    <ul class="portfolio-list">
        {{ range $pages }}
        {{/* Read build flags safely */}}
        {{ $render := "" }}
        {{ $list := "" }}
        {{ with .Params.build }}
        {{ $render = (index . "render" | default "") }}
        {{ $list = (index . "list" | default "") }}
        {{ end }}

        {{/* Skip entirely if list == "never" or if draft */}}
        {{ if and (ne $list "never") (not .Draft) }}
        {{/* Only link when a page will be written: render "" or "always" */}}
        {{ $linkable := or (eq $render "") (eq $render "always") }}

        <li class="portfolio-item">
            <!-- Title -->
            {{ if $linkable }}
            <a href="{{ .RelPermalink }}" class="portfolio-title">{{ .Title }}</a>
            {{ else }}
            <span class="portfolio-title" aria-disabled="true" title="Write-up coming soon">{{ .Title }}</span>
            {{ end }}

            {{/* Summary */}}
            {{ if or .Params.summary .Summary }}
            <p class="portfolio-summary">
                {{ with .Params.summary }}{{ . }}{{ else }}{{ .Summary }}{{ end }}
            </p>
            {{ end }}

            {{/* Highlights */}}
            {{ with .Params.highlights }}
            {{ if gt (len .) 0 }}
            <ul class="portfolio-highlights">
                {{ range first 3 . }}<li>{{ . | markdownify }}</li>{{ end }}
            </ul>
            {{ end }}
            {{ end }}

            <!-- Tags -->
            {{ with .GetTerms "portfolio_tags" }}
            <div class="tags-block">
                {{ range . }}
                <a class="tag" href="{{ .RelPermalink }}">{{ .LinkTitle }}</a>
                {{ end }}
            </div>
            {{ end }}
        </li>
        {{ end }}
        {{ end }}
    </ul>
</main>
{{ end }}